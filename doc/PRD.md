# 庄园插件产品需求文档 (PRD)

## 1. 文档信息

**文档版本**: 1.0
**项目名称**: AstrBot 庄园插件
**项目代号**: astrbot_plugin_gaismanor

## 2. 项目概述

### 2.1 项目背景
AstrBot 庄园插件是一个为机器人平台开发的休闲娱乐插件，旨在为用户提供一个有趣的庄园游戏体验。通过模拟真实庄园过程，结合游戏化元素，增强用户与机器人的互动性。

### 2.2 项目目标
- 为 AstrBot 用户提供娱乐性庄园游戏体验
- 建立完整的虚拟经济系统
- 增强用户粘性和活跃度
- 提供丰富的游戏内容和社交互动功能

## 3. 产品功能需求

### 3.1 核心功能模块

#### 3.1.1 基础钓鱼系统
**功能描述**: 用户可以通过命令进行钓鱼操作，获得不同稀有度的鱼类。

**功能特性**:
- 钓鱼冷却时间机制 (默认3分钟)
- 消耗金币进行钓鱼 (默认10金币)
- 不同稀有度鱼类 (1-5星)
- 钓鱼成功率机制
- 鱼类重量和价值随机生成

**用户流程**:
1. 用户输入 `/注册` 命令创建账户
2. 用户输入 `/钓鱼` 命令开始钓鱼
3. 系统检查用户金币和冷却时间
4. 执行钓鱼逻辑并返回结果
5. 更新用户状态和鱼塘库存

#### 3.1.2 用户系统
**功能描述**: 管理用户基本信息、状态和进度。

**功能特性**:
- 用户注册和基础信息管理
- 金币管理系统
- 钓鱼统计数据 (总次数、总重量、总收入)
- 每日签到奖励机制
- 自动钓鱼功能

**用户流程**:
1. 新用户输入 `/注册` 创建账户
2. 用户可通过 `/签到` 获得每日奖励
3. 用户可启用 `/自动钓鱼` 功能
4. 用户可通过 `/状态` 查看个人信息

#### 3.1.3 背包与资产管理
**功能描述**: 管理用户收集的鱼类、装备和物品。

**功能特性**:
- 鱼塘容量管理 (默认480条鱼)
- 鱼类分类展示
- 装备管理 (鱼竿、饰品)
- 鱼饵库存管理
- 鱼类出售功能

**用户流程**:
1. 用户输入 `/鱼塘` 查看已捕获鱼类
2. 用户输入 `/鱼竿` 查看拥有鱼竿
3. 用户输入 `/饰品` 查看拥有饰品
4. 用户输入 `/鱼饵` 查看拥有鱼饵
5. 用户可通过不同命令出售鱼类和装备

#### 3.1.4 装备系统
**功能描述**: 提供钓鱼装备以增强钓鱼效果。

**功能特性**:
- 鱼竿系统 (不同稀有度和属性)
- 饰品系统 (提供额外加成)
- 鱼饵系统 (临时效果加成)
- 装备精炼系统 (提升装备属性)
- 装备装备/卸下功能

**用户流程**:
1. 用户通过商店或抽卡获得装备
2. 用户输入 `/使用鱼竿 ID` 装备鱼竿
3. 用户输入 `/使用饰品 ID` 装备饰品
4. 用户输入 `/使用鱼饵 ID` 使用鱼饵

#### 3.1.5 商店与市场系统
**功能描述**: 提供物品购买和交易功能。

**功能特性**:
- 商店购买功能
- 用户间交易市场
- 物品上架和购买
- 市场税率机制
- 物品价格显示

**用户流程**:
1. 用户输入 `/商店` 查看可购买物品
2. 用户输入 `/购买鱼竿/鱼饵 ID` 购买物品
3. 用户输入 `/市场` 查看市场物品
4. 用户输入 `/上架鱼竿/饰品 ID 价格` 上架物品
5. 用户输入 `/购买 ID` 购买市场物品

#### 3.1.6 抽卡系统
**功能描述**: 提供随机获取稀有物品的机制。

**功能特性**:
- 多种抽卡池
- 单抽和十连抽功能
- 不同稀有度物品掉落
- 抽卡概率公示
- 抽卡历史记录

**用户流程**:
1. 用户输入 `/抽卡` 查看所有卡池
2. 用户输入 `/抽卡 ID` 进行单次抽卡
3. 用户输入 `/十连 ID` 进行十连抽卡
4. 用户输入 `/查看卡池 ID` 查看卡池详情
5. 用户输入 `/抽卡记录` 查看抽卡历史

#### 3.1.7 社交系统
**功能描述**: 提供用户间互动和竞争功能。

**功能特性**:
- 钓鱼排行榜
- 鱼类图鉴收集系统
- 成就系统
- 称号系统
- 偷鱼互动功能

**用户流程**:
1. 用户输入 `/排行榜` 查看排名
2. 用户输入 `/鱼类图鉴` 查看收集进度
3. 用户输入 `/查看成就` 查看成就进度
4. 用户输入 `/查看称号` 查看拥有称号
5. 用户可通过 @ 用户进行偷鱼互动

#### 3.1.8 经济系统
**功能描述**: 管理游戏内虚拟经济平衡。

**功能特性**:
- 金币获取和消耗机制
- 税收系统 (针对高资产用户)
- 擦弹玩法 (风险投资机制)
- 物品定价和价值体系
- 经济平衡调节

**用户流程**:
1. 用户通过钓鱼、签到获得金币
2. 用户通过购买、升级消耗金币
3. 高资产用户需缴纳每日税收
4. 用户可通过 `/擦弹 金币数` 参与擦弹玩法

### 3.2 管理功能模块

#### 3.2.1 后台管理系统
**功能描述**: 提供管理员配置和管理功能。

**功能特性**:
- Web管理界面
- 游戏数据配置
- 用户数据管理
- 物品模板管理
- 系统监控

#### 3.2.2 管理员命令
**功能描述**: 提供管理员专用命令。

**功能特性**:
- 用户金币修改
- 系统状态监控
- 后台服务管理
- 数据统计查看

## 4. 非功能性需求

### 4.1 性能需求
- 系统响应时间不超过2秒
- 支持同时在线用户数不少于1000人
- 数据库查询优化，确保高频操作响应迅速

### 4.2 可靠性需求
- 系统可用性不低于99%
- 数据持久化存储，防止数据丢失
- 异常处理机制完善，避免系统崩溃

### 4.3 安全性需求
- 用户数据加密存储
- 命令权限控制
- 防止恶意刷取金币
- 输入参数校验

### 4.4 可维护性需求
- 模块化设计，便于功能扩展
- 代码注释完整
- 数据库迁移机制
- 日志记录完整

## 5. 技术架构

### 5.1 系统架构
```
┌─────────────────┐
│   用户界面层     │ (命令接口)
└─────────────────┘
         │
┌─────────────────┐
│   业务逻辑层     │ (服务层)
└─────────────────┘
         │
┌─────────────────┐
│   数据访问层     │ (仓储模式)
└─────────────────┘
         │
┌─────────────────┐
│   数据存储层     │ (SQLite数据库)
└─────────────────┘
```

### 5.2 核心组件
- **主插件类**: GaisManorPlugin - 插件入口点
- **服务层**: 各种业务服务 (FishingService, UserService等)
- **仓储层**: 数据访问接口实现 (SQLite仓储)
- **领域模型**: 游戏实体定义 (User, Fish, Rod等)
- **工具类**: 辅助功能函数

### 5.3 数据库设计
- 用户表 (users)
- 鱼类模板表 (fish_templates)
- 鱼竿模板表 (rod_templates)
- 饰品模板表 (accessory_templates)
- 鱼饵模板表 (bait_templates)
- 用户鱼类库存表 (user_fish_inventory)
- 用户装备实例表 (user_rod_instances, user_accessory_instances)
- 日志表 (fishing_logs, gacha_logs等)
- 市场表 (market_listings)
- 成就表 (achievements)

## 7. 数据需求

### 7.1 用户数据
- 基本信息 (用户ID、昵称、创建时间)
- 游戏状态 (金币、经验值、等级)
- 装备信息 (当前装备、拥有物品)
- 统计数据 (钓鱼次数、总收入等)

### 7.2 游戏数据
- 鱼类模板 (名称、稀有度、价值、描述)
- 装备模板 (属性、稀有度、来源)
- 鱼饵模板 (效果、持续时间)
- 抽卡池配置 (奖品、概率)
- 成就配置 (条件、奖励)

### 7.3 日志数据
- 钓鱼记录 (时间、结果、装备)
- 抽卡记录 (时间、结果)
- 交易记录 (买卖、价格)
- 成就记录 (完成时间)
- 税收记录 (金额、时间)

## 10. 项目里程碑

### 10.1 第一阶段
-  用户系统搭建
-  核心钓鱼功能实现
-  基础装备系统
-  商店和市场系统

### 10.2 第二阶段
-  抽卡系统实现
-  社交功能添加
-  经济系统完善
-  后台管理系统

### 10.3 第三阶段
-  成就模块分离
-  图鉴功能丰富
-  图形化输出优化
-  代码重构优化

## 13. 附录

### 13.1 配置说明
所有配置项均在 `_conf_schema.json` 中定义，支持运行时修改。