一、游戏简介
Gaismanor 是一款基于 Astrbot 开发的对话类休闲游戏插件，专为群聊场景设计，目前主要支持渔场玩法。玩家可以在游戏中体验丰富的钓鱼、装备收集与升级、社交互动等功能，通过完成各种任务和挑战来提升自己的等级、获取金币和稀有装备，与其他玩家一较高下。
二、基础玩法与指令
（一）账号注册与签到
● 注册：玩家首次进入游戏时，发送“/注册”指令即可创建账号。系统会为新用户分配 200 初始金币，并将其用户 ID、平台和昵称等信息存储在 SQLite 数据库的 users 表中。
● 签到：每日签到是积累经验和金币的重要途径。玩家使用“/签到”指令后，系统会检查其是否已签到。若未签到，则给予基础奖励（100 金币 + 10 经验）以及根据连续签到天数递增的额外奖励，并将签到记录存储在 sign_in_logs 表中。
（二）等级与金币系统
● 等级：玩家的等级由经验值决定，计算公式为 level = sqrt(exp / 100) + 1，最高可达 100 级。每当玩家升级时，会根据等级区间获得相应金币奖励（1 - 10 级 50 金币，11 - 20 级 100 金币，依次类推），等级和经验信息均存储在 users 表中。
● 金币：作为游戏内的主要货币，金币可用于购买物品、参与活动等。玩家可通过签到、升级、钓鱼等方式获取金币，其余额实时更新在 users 表的 gold 字段中。
三、鱼塘系统
（一）基础功能
● 鱼塘容量：玩家初始鱼塘容量为 50 条鱼，可通过“/升级鱼塘”命令消耗金币进行扩展，每次升级增加的容量和所需金币数量根据等级不同而有所变化，存在最高等级限制，升级费用依次为 500、1000、2000、5000、10000 金币。
● 鱼类存储：钓鱼成功后，捕获的鱼会自动存入用户鱼塘（user_fish_inventory 表），每条鱼记录包括鱼的模板 ID、重量、价值和捕获时间，玩家可随时查看和管理鱼塘中的鱼。
（二）主要命令
● /鱼塘：展示用户当前鱼塘中的所有鱼类，包括名称、稀有度（星级）、重量和价值，同时显示鱼塘总重量、总价值和容量使用情况。
● /升级鱼塘：允许用户消耗金币扩展鱼塘容量，显示当前等级、升级费用和升级后的容量，并检查用户金币是否充足。
● /鱼塘容量：直观呈现用户当前鱼塘的容量使用情况（当前数量 / 总容量）。
（三）数据结构与相关服务
● 数据库表：user_fish_inventory 表存储用户捕获的鱼类，users 表中的 fish_pond_capacity 字段记录用户鱼塘容量。
● 模型类：FishInventory 模型表示用户鱼塘中的单条鱼，User 模型中的 fish_pond_capacity 属性表示鱼塘容量。
● InventoryService：负责处理鱼塘相关操作，包括获取鱼塘信息、处理查看和升级命令、管理容量检查等。
（四）系统特点
● 容量限制：防止用户无限制存储鱼类，需通过升级扩展容量，维持游戏平衡。
● 可视化管理：玩家可清晰查看鱼塘中的鱼类及其价值，便于管理和决策。
● 渐进式升级：升级费用和容量增加量随等级提升，增加游戏的长期可玩性。
● 经济平衡：通过金币消耗维持游戏经济平衡，确保游戏的可持续性。
四、装备系统
（一）鱼竿系统
● 鱼竿属性：鱼竿具有稀有度（1 - 5 星）、品质加成、数量加成、稀有度加成、耐久度以及等级和经验等属性，这些属性共同影响钓鱼的成功率、收益和体验。
● 鱼竿类型：游戏中有 5 种预设鱼竿，包括新手木竿（1 星，耐久度 200）、竹制鱼竿（2 星，耐久度 400，稀有鱼几率略有提升）、碳素纤维竿（3 星，耐久度 1000，品质加成提升）、星辰钓者（4 星，耐久度 2000，各项属性显著提升）和海神之赐（5 星，耐久度 5000，所有属性大幅提升）。
● 鱼竿功能：玩家可装备鱼竿以获得属性加成，使用过程中鱼竿耐久度会消耗，耐久度为 0 时可消耗金币维修，也可卸下当前装备的鱼竿。
（二）鱼饵系统
● 鱼饵属性：鱼饵具有稀有度（1 - 5 星）、成功率加成、稀有鱼几率加成、垃圾减少加成、价值加成、数量加成以及消耗性（分为消耗型和非消耗型）等属性，用于提升钓鱼效果。
● 鱼饵类型：游戏中包含多种不同效果的鱼饵，如基础鱼饵（普通蚯蚓、面包团、玉米粒等）、进阶鱼饵（红虫、亮片拟饵、腥味颗粒饵等）、高级鱼饵（万能饵、活虾、驱散垃圾饵等）、稀有鱼饵（秘制香饵、价值连城饵、大师拟饵等）和传说鱼饵（巨物诱饵、丰饶号角粉末等）。
● 鱼饵功能：玩家可在商店购买鱼饵，使用后可获得临时属性加成，还可查看和管理自己的鱼饵库存。
（三）商店系统
● 鱼竿商店：提供各种稀有度的鱼竿供玩家购买，展示鱼竿的价格、属性和描述信息，支持库存管理和商品上架 / 下架操作。
● 鱼饵商店：提供各种稀有度的鱼饵供玩家购买，展示鱼饵的价格、效果和描述信息，同样支持库存管理和商品上架 / 下架操作。
● 装备命令：玩家可使用命令查看自己的鱼竿和鱼饵库存，装备或使用指定的鱼竿和鱼饵，也可卸下当前装备的鱼竿。
● 属性加成：钓鱼时，系统会根据玩家装备的鱼竿和鱼饵计算成功率、稀有鱼几率、价值加成等多方面的加成效果。
● 维修系统：当鱼竿耐久度为 0 时，需进行维修才能继续使用，维修费用根据鱼竿的稀有度计算，维修后鱼竿耐久度恢复到最大值。
（四）商店功能概述
● 用户端功能：玩家可查看商店商品、使用金币购买鱼竿和鱼饵、管理商店库存以及控制商品的上架和下架状态。
● 管理端功能：管理员可在 WebUI 中管理商店商品，包括设置价格、库存数量、控制商品上下架等操作。
● 数据库结构：商店系统使用 shop_rod_templates 表存储鱼竿商店商品信息，shop_bait_templates 表存储鱼饵商店商品信息，这两张表分别与对应的装备模板表（rod_templates 和 bait_templates）通过外键关联。
● 核心功能实现：商店商品通过 LEFT JOIN 查询获取装备模板和商店设置的信息，玩家购买商品时，系统会依次检查商品是否存在且上架、用户金币是否足够、商品库存是否充足（对于有限库存商品），然后扣除用户金币并减少库存（对于有限库存商品），最后将购买的商品添加到用户库存中。
● 商品管理：管理员可添加商品到商店，设置价格、库存等属性；编辑已上架商品的价格、库存和上下架状态；移除商店中的商品，使其不再销售。
● 商店系统特点：
    ○ 灵活定价：商店中的商品可设置与模板不同的价格，满足不同玩家需求。
    ○ 库存管理：支持有限库存和无限库存两种模式，增加游戏的策略性和趣味性。
    ○ 状态控制：可随时上下架商品，灵活控制销售状态。
    ○ 分类管理：鱼竿和鱼饵分开管理，便于维护和查找。
    ○ 用户友好：提供搜索功能，方便玩家快速查找所需商品。
    ○ Web 管理界面：提供图形化管理界面，便于管理员操作和管理商店。
五、抽卡系统
（一）系统概述
抽卡系统是获取稀有装备的重要玩法之一，玩家可通过消耗金币进行抽卡，获得鱼竿、饰品和鱼饵等装备。系统包含多个卡池，每个卡池有不同的稀有度概率分布和包含的物品，玩家可选择单次抽卡或十连抽卡来获取装备。
（二）核心功能
● 单次抽卡：玩家发送“/抽卡 <卡池 ID>”指令，消耗 100 金币进行一次抽卡，系统根据卡池稀有度权重随机确定物品稀有度，再随机选择物品类型（鱼竿、饰品或鱼饵），最后从卡池中随机选择具体物品，并将结果添加到用户背包中。
● 十连抽卡：玩家发送“/十连 <卡池 ID>”指令，消耗 900 金币进行十次抽卡（相当于 9 折优惠），一次获得 10 个物品，结果按稀有度分组显示。
● 卡池设计：系统包含三种预设卡池，普通卡池消耗 100 金币，包含各种基础装备和物品；高级卡池消耗 500 金币，包含稀有装备和物品；限定卡池消耗 1000 金币，包含限定稀有装备。物品分为 5 个稀有度等级，1 星概率 50%，2 星概率 30%，3 星概率 15%，4 星概率 4%，5 星概率 1%。
● 物品获取与存储：抽到的鱼竿添加到用户鱼竿背包中，饰品添加到饰品背包中，鱼饵则增加用户对应鱼饵的库存数量。抽卡结果存储在 gacha_logs 表中，包含用户 ID、物品类型、物品模板 ID、稀有度和抽卡时间戳等信息。
（三）管理功能
● 卡池管理界面：提供 WebUI 界面用于管理卡池配置，管理员可查看卡池详细信息，编辑卡池名称、描述、稀有度概率权重以及选择卡池包含的物品。
● 卡池配置：包含基本信息（名称、描述、排序等）、稀有度权重（每种稀有度的抽取概率）和包含物品（卡池中可抽取的物品列表）。
（四）用户交互命令
● 可用命令：
    ○ /抽卡 <卡池 ID>：进行单次抽卡。
    ○ /十连 <卡池 ID>：进行十连抽卡。
    ○ /查看卡池 <卡池 ID>：查看指定卡池的详细信息，包括卡池描述和包含的所有物品。
    ○ /抽卡记录：查看最近的抽卡历史，显示最近 20 条抽卡记录，包括时间、投入金币数、获得倍数、获得金币数和净收益等信息。
● 结果展示：
    ○ 抽卡结果：显示获得物品的名称、稀有度和剩余金币。
    ○ 十连结果：按稀有度分组显示所有获得的物品。
    ○ 卡池信息：详细展示卡池描述和包含的所有物品。
● 系统特点：
    ○ 概率机制：基于权重的概率系统确保抽卡的随机性和公平性。
    ○ 经济平衡：不同卡池消耗不同的金币，十连抽提供折扣，维持游戏经济平衡。
    ○ 物品多样性：可抽取鱼竿、饰品、鱼饵三种类型的物品，增加游戏的丰富性。
    ○ 可视化管理：提供 WebUI 界面方便管理员配置卡池，提高管理效率。
    ○ 记录追踪：保存抽卡记录供用户查看历史，增加游戏的透明度和可追溯性。
    ○ 稀有度展示：使用星级符号直观显示物品稀有度，方便玩家快速了解物品价值。
六、擦弹系统
（一）系统概述
擦弹系统是一种高风险高回报的玩法，玩家可投入金币获得随机倍数的回报。该系统有次数限制和复杂的概率机制，旨在增加游戏的刺激性和娱乐性，同时确保游戏的平衡性。
（二）核心功能
● 基本玩法：玩家可投入任意数量的金币进行擦弹，也可使用特殊参数“梭哈 / allin”（投入全部金币）或“梭一半 / halfin”（投入一半金币）。
● 次数限制：每个玩家每天最多可进行 3 次擦弹，系统通过检查当天的擦弹日志来实现次数限制。
● 倍数机制：擦弹结果的倍数分布如下：0.1x（15% 概率）、0.5x（15% 概率）、1x（20% 概率）、2x（25% 概率）、3x（12% 概率）、5x（9% 概率）、10x（4% 概率）。
● 奖励机制：获得 5 倍及以上奖励时显示🎉恭喜信息；获得 2 - 4 倍奖励时显示😊不错信息；获得 1 倍奖励时显示🙂还行信息；获得 0.1 - 0.5 倍奖励时显示😢很遗憾信息。
（三）概率调整机制
● 保底机制：连续 2 次或以上获得 0.1x 或 0.5x 倍数后，下次擦弹必然不会获得 0.1x 倍数，0.1x 的概率会转移到 0.5x 上。
● 递增概率机制：连续失败次数越多，获得高倍数奖励的概率会略微提升，增加的概率从低倍数转移到高倍数（5x 和 10x）。
● 动态调整机制：根据玩家金币数量调整概率。当玩家金币较多时（超过基准的 2 倍），降低 5x 和 10x 的概率，增加 0.1x、0.5x 和 1x 的概率；当玩家金币较少时（不到基准的一半），提高 5x 和 10x 的概率，降低 0.1x 和 0.5x 的概率。
（四）系统限制
● 次数限制：每个玩家每天最多可进行 3 次擦弹，防止玩家过度沉迷。
● 金币限制：投入金币数必须大于 0，且玩家投入的金币不能超过其拥有的金币数量。
（五）数据记录
● 擦弹日志：所有擦弹记录存储在 wipe_bomb_logs 表中，包括用户 ID、投入金币数、获得倍数、获得金币数和擦弹时间戳等信息。
● 成就追踪：系统会追踪玩家获得的最大擦弹倍数，用于成就解锁。当玩家获得 10 倍及以上奖励时，可解锁“擦弹之王”称号。
（六）用户交互命令
● 可用命令：
    ○ /擦弹 [金币数]：投入指定金币数进行擦弹。
    ○ /擦弹 [特殊参数]：使用特殊参数（梭哈 / 梭一半 / allin / halfin）进行擦弹。
    ○ /擦弹记录：查看最近的擦弹记录。
● 参数说明：
    ○ 金币数：玩家指定的具体金币数量。
    ○ 特殊参数：
        ■ 梭哈 或 allin：投入所有金币。
        ■ 梭一半 或 halfin：投入一半金币。
● 返回结果：
    ○ 擦弹结果：
        ■ 成功结果（2 倍及以上）：
            ■ 🎉恭喜！擦弹成功！
            ■ 投入金币：[数量]
            ■ 获得倍数：[倍数]x
            ■ 获得金币：[数量]
            ■ 剩余次数：[次数]次
        ■ 一般结果（1 倍）：
            ■ 🙂还行！擦弹成功！
            ■ 投入金币：[数量]
            ■ 获得倍数：[倍数]x
            ■ 获得金币：[数量]
            ■ 剩余次数：[次数]次
        ■ 失败结果（0.1 - 0.5 倍）：
            ■ 😢很遗憾，擦弹失败了...
            ■ 投入金币：[数量]
            ■ 获得倍数：[倍数]x
            ■ 获得金币：[数量]
            ■ 剩余次数：[次数]次
    ○ 擦弹记录：
        ■ === 擦弹记录 ===
        ■ [时间]投入金币：[数量]
        ■ 获得倍数：[倍数]x
        ■ 获得金币：[数量]
        ■ 净收益：[收益]
（七）系统特点
● 高风险高回报：倍数范围广，从 0.1x 到 10x，玩家可能获得巨额收益或损失，增加游戏的刺激性。
● 智能概率调整：通过保底机制和递增概率机制，确保玩家不会长期连续失败，提高游戏的趣味性和公平性。
● 动态平衡：根据玩家金币数量调整概率，避免富有的玩家一直获胜或穷有的玩家无法翻身，维持游戏的经济平衡。
● 次数限制：每天最多 3 次擦弹，防止玩家过度沉迷，保障玩家的健康游戏。
● 成就系统：追踪玩家的最大倍数，解锁相应成就，激励玩家挑战更高难度，增加游戏的长期可玩性。
● 透明记录：保存擦弹记录供玩家查看历史表现，增加游戏的透明度和可追溯性，让玩家对自己的游戏行为有清晰的认识。
七、社交系统
（一）称号系统
称号系统是成就奖励的重要组成部分，为玩家提供荣誉感和标识。玩家通过完成特定成就获得称号，并可在排行榜和玩家信息中显示当前激活的称号。每个玩家可拥有多个称号，但只能激活一个。
1. 称号功能
● 获取方式：通过完成特定成就解锁。
● 显示：在排行榜和玩家信息中显示当前激活的称号。
● 管理：玩家可拥有多个称号，但只能激活一个。
2. 称号类型
系统中定义了多个称号，主要通过成就奖励获得：
● “新手钓手”：第一次钓鱼。
● “钓鱼大师”：累计钓到 1000 条鱼。
● “初露锋芒”：累计钓鱼总重量达到 10,000 公斤。
● “图鉴收藏家”：钓到 10 种不同的鱼。
● “回收大师”：累计钓上 50 个垃圾物品。
● “百万富翁”：累计赚取 1,000,000 金币。
● “擦弹之王”：在擦弹中获得 10 倍或以上奖励。
（二）成就系统
成就系统是游戏的核心激励机制之一，通过完成特定目标获得奖励，包括金币奖励、称号奖励、鱼饵奖励和饰品奖励等。
1. 成就分类
● 钓鱼成就：
    ○ 累计钓鱼数量（100 条、1000 条、10000 条）。
    ○ 累计钓鱼重量（10,000 公斤）。
    ○ 钓到超重鱼类（超过 100 公斤）。
● 收集成就：
    ○ 图鉴收集（10 种、25 种、50 种不同鱼类）。
    ○ 垃圾收集（50 个垃圾物品）。
    ○ 装备收集（获得特定稀有度的鱼竿和饰品）。
● 经济成就：
    ○ 累计赚取金币（1,000,000 金币）。
    ○ 擦弹倍数（获得 10 倍及以上奖励）。
2. 成就奖励
● 金币奖励：直接增加玩家金币数。
● 称号奖励：解锁特定称号。
● 鱼饵奖励：增加特定鱼饵库存。
● 饰品奖励：增加特殊货币。
3. 成就检查机制
● 进度追踪：系统实时追踪玩家的各种游戏数据。
● 自动检查：在相关事件发生时自动检查成就完成情况。
● 奖励发放：成就完成后自动发放奖励并记录。
（三）排行榜系统
排行榜是展示玩家实力和成就的重要功能，激励玩家竞争。
1. 排行榜类型
系统当前实现了一个综合排行榜，综合考虑以下因素：
● 金币数量。
● 钓鱼次数。
● 总收入。
2. 排行榜特点
● 群组隔离：不同群聊有不同的排行榜。
● 实时更新：根据玩家当前数据实时计算排名。
● 可视化展示：以图片形式展示排行榜，包含玩家装备和称号信息。
3. 排行榜数据
排行榜显示以下信息：
● 玩家昵称。
● 当前称号。
● 持有金币数。
● 钓鱼次数。
● 装备的鱼竿。
● 装备的饰品。
4. 计算方法
综合得分 = 金币数 + 钓鱼次数 × 10 + 总收入。
（四）图鉴系统
图鉴系统展示游戏中的所有鱼类信息，是收集类成就的重要组成部分。
1. 图鉴功能
● 查看功能：显示所有鱼类的基本信息。
● 分类展示：按稀有度分组显示鱼类。
● 信息详情：显示鱼类名称、描述和基础价值。
2. 图鉴特点
● 完整性：显示游戏中的所有鱼类。
● 清晰分类：通过星级标识稀有度。
● 信息丰富：包含鱼类的详细介绍和价值信息。
3. 相关成就
图鉴系统与收集类成就紧密相关：
● “图鉴收集者 I”：收集 10 种不同鱼类。
● “图鉴收集者 II”：收集 25 种不同鱼类。
● “图鉴收集者 III”：收集 50 种不同鱼类。
（五）系统交互
● 用户命令：
    ○ /排行榜：查看当前群组的综合排行榜。
    ○ /鱼类图鉴：查看所有鱼类信息。
    ○ /钓鱼记录：查看个人钓鱼历史。
    ○ 各类成就相关命令：在完成时自动触发。
（六）数据存储
系统使用多个数据库表来存储相关信息：
● user_titles：用户称号关联。
● titles：称号模板。
● achievements：成就模板。
● user_achievements：用户成就完成记录。
（七）系统特点
● 激励机制：通过成就和排行榜激励玩家持续参与游戏。
● 荣誉体系：通过称号系统提供荣誉感和身份标识。
● 收集乐趣：通过图鉴系统增加收集元素的趣味性。
● 竞争元素：通过排行榜引入玩家间的良性竞争。
● 多样化奖励：通过不同类型奖励满足不同玩家的需求。
● 数据可视化：通过图片形式展示排行榜增加视觉效果。